<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>WebXStudio: –ó–∞–¥–∞–Ω–∏—è</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        /* ================================================= */
        /* –ü–ï–†–ï–ú–ï–ù–ù–´–ï –ò –ë–ê–ó–û–í–´–ï –°–¢–ò–õ–ò (MOBILE FIRST) */
        /* ================================================= */
        :root {
            --tg-text-color: #000000;
            --tg-bg-color: #FFFFFF;
            --tg-secondary-bg-color: #F8F8F8;
            --tg-hint-color: #9C9C9C;
            --tg-link-color: #007AFF;
            --tg-button-color: #007AFF; 
            --tg-button-text-color: #FFFFFF;
            --task-price-color: #4CAF50; /* –ó–µ–ª–µ–Ω—ã–π –¥–ª—è —Ü–µ–Ω */
            --mir-logo-color: #FF7B00; /* –¶–≤–µ—Ç –¥–ª—è –ú–ò–† */
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            margin: 0;
            padding: 0 0 70px 0;
            background-color: var(--tg-theme-bg-color, var(--tg-bg-color));
            color: var(--tg-theme-text-color, var(--tg-text-color));
            overflow-x: hidden;
            -webkit-user-select: none;
            user-select: none;
            min-height: 100vh;
        }
        
        /* –ì–ª–æ–±–∞–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤, —Å—Ç—Ä–µ–ª–æ–∫ –∏ –æ—Ç—Å—Ç—É–ø–æ–≤ */
        .header {
            display: flex;
            align-items: center;
            padding: 15px;
            font-size: 17px;
            font-weight: 600;
            line-height: 22px;
        }
        .back-arrow {
            font-size: 24px;
            margin-right: 15px;
            cursor: pointer;
            font-weight: 400;
        }
        .content-wrap {
            padding: 0 15px;
        }

        /* --- –§–∏–ª—å—Ç—Ä—ã --- */
        .task-filters {
            display: flex;
            overflow-x: scroll;
            padding: 0 15px 15px 15px;
            margin: 0 -15px;
            gap: 8px;
            -webkit-overflow-scrolling: touch;
        }
        .task-filters::-webkit-scrollbar { display: none; }

        .filter-button {
            flex-shrink: 0;
            padding: 7px 15px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 500;
        }
        .filter-button.active {
            background-color: var(--tg-theme-button-color, var(--tg-button-color));
            color: var(--tg-theme-button-text-color, var(--tg-button-text-color));
        }
        .filter-button:not(.active) {
            background-color: var(--tg-theme-secondary-bg-color, #EFEFEF);
            color: var(--tg-theme-text-color, var(--tg-text-color));
        }

        /* --- –°—Ç–∏–ª–∏ —Å–ø–∏—Å–∫–∞ –∑–∞–¥–∞–Ω–∏–π --- */
        .task-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid var(--tg-theme-secondary-bg-color, #EFEFEF);
        }
        .task-left {
            display: flex;
            align-items: center;
        }
        .task-icon {
            width: 40px; height: 40px; border-radius: 8px;
            display: flex; justify-content: center; align-items: center;
            background-color: var(--tg-theme-secondary-bg-color);
            margin-right: 12px; font-size: 20px;
        }
        .task-info-main { flex-grow: 1; }
        .task-title { font-weight: 500; font-size: 16px; }
        .task-hint { font-size: 13px; color: var(--tg-theme-hint-color); }
        .task-action-btn {
            padding: 6px 12px;
            background-color: var(--tg-theme-button-color);
            color: var(--tg-theme-button-text-color);
            border: none;
            border-radius: 18px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            flex-shrink: 0;
            margin-left: 15px;
        }

        /* --- –°—Ç–∏–ª–∏ –¥–µ—Ç–∞–ª–µ–π –∑–∞–¥–∞–Ω–∏—è (–¥–ª—è —ç–∫–æ–Ω–æ–º–∏–∏ –º–µ—Å—Ç–∞, –¥–µ—Ç–∞–ª–∏ –Ω–µ –∏–∑–º–µ–Ω–µ–Ω—ã) --- */
        .task-detail-price {
            font-size: 40px;
            font-weight: 700;
            color: var(--task-price-color);
            margin: 10px 0;
        }
        .task-detail-images {
            display: flex;
            gap: 10px;
            margin: 15px 0;
        }
        .image-placeholder {
            width: 100px; height: 100px; border-radius: 8px;
            background-color: var(--tg-theme-secondary-bg-color);
            display: flex; justify-content: center; align-items: center;
            font-size: 14px; color: var(--tg-theme-hint-color); cursor: pointer;
            transition: background-color 0.2s;
        }
        .upload-icon { font-size: 30px; }

        /* --- –°—Ç–∏–ª–∏ –∫–æ—à–µ–ª—å–∫–∞ --- */
        .wallet-balance-wrap { 
            text-align: center; 
            padding: 20px 0 10px 0; 
            line-height: 1.2;
            color: var(--tg-theme-hint-color);
        }
        .wallet-balance {
            font-size: 40px;
            font-weight: 700;
            margin: 10px 0;
            color: var(--tg-theme-text-color);
        }
        .wallet-actions {
            display: flex;
            justify-content: space-around;
            padding: 15px 0;
            border-bottom: 1px solid var(--tg-theme-secondary-bg-color);
        }
        .wallet-action-item {
            text-align: center;
            cursor: pointer;
            font-size: 14px;
            color: var(--tg-theme-hint-color);
        }
        .wallet-action-item .icon {
            font-size: 24px;
            margin-bottom: 5px;
            background-color: var(--tg-theme-secondary-bg-color);
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            margin: 0 auto 5px auto;
        }

        .transaction-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid var(--tg-theme-secondary-bg-color);
        }
        .transaction-amount-text {
            font-weight: 600;
            /* –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ü–≤–µ—Ç –¥–ª—è —Ç–µ–∫—Å—Ç–∞ (–∫–∞–∫ –Ω–∞ —Å–∫—Ä–∏–Ω—à–æ—Ç–µ) */
            color: var(--tg-theme-text-color); 
        }
        .transaction-card-info {
            font-size: 13px;
            color: var(--tg-theme-hint-color);
            text-align: right;
        }
        .mir-logo { color: var(--mir-logo-color); font-weight: bold; }

        /* --- –ù–∏–∂–Ω–µ–µ –ù–∞–≤–∏–≥–∞—Ü–∏–æ–Ω–Ω–æ–µ –ú–µ–Ω—é --- */
        .bottom-nav {
            position: fixed; bottom: 0; left: 0; width: 100%;
            display: flex; justify-content: space-around; align-items: center;
            height: 60px;
            background-color: var(--tg-theme-secondary-bg-color, #F8F8F8);
            border-top: 1px solid #D1D1D1; z-index: 1000;
        }
        .nav-item {
            flex: 1; text-align: center; color: var(--tg-theme-hint-color); padding: 5px 0;
        }
        .nav-item.active { color: var(--tg-theme-text-color); font-weight: 600; }
        .nav-icon { font-size: 24px; }
    </style>
</head>
<body>

    <div id="app-container">
        
        <div id="screen-tasks" class="app-screen">
            <div class="header" style="justify-content: space-between; padding-right: 25px;">
                 –ó–∞–¥–∞–Ω–∏—è
                 <span style="font-size: 20px;">‚öôÔ∏è</span>
            </div>
            
            <div class="task-filters">
                <div class="filter-button active">–í—Å–µ (35)</div>
                <div class="filter-button">ChatGPT</div>
                <div class="filter-button">Midjourney</div>
                <div class="filter-button">DALL-E 3</div>
            </div>
            
            <div class="content-wrap task-list">
                <div class="task-item">
                    <div class="task-left">
                        <div class="task-icon">üå≥</div> 
                        <div class="task-info-main">
                            <div class="task-title">–°–¥–µ–ª–∞—Ç—å —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—é</div>
                            <div class="task-hint">520 ‚ÇΩ ‚Ä¢ ChatGPT</div>
                        </div>
                    </div>
                    <button class="task-action-btn" onclick="openTaskDetails('photo_tree', '–°–¥–µ–ª–∞—Ç—å —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—é', 520, 'ChatGPT')">
                        –í—ã–ø–æ–ª–Ω–∏—Ç—å
                    </button>
                </div>

                <div class="task-item">
                    <div class="task-left">
                        <div class="task-icon">üë§</div>
                        <div class="task-info-main">
                            <div class="task-title">–ü—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ</div>
                            <div class="task-hint">350 ‚ÇΩ ‚Ä¢ VEOS V</div>
                        </div>
                    </div>
                    <button class="task-action-btn" onclick="openTaskDetails('new_user', '–ü—Ä–∏–≥–ª–∞—Å–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è', 350, 'VEOS V')">
                        –í—ã–ø–æ–ª–Ω–∏—Ç—å
                    </button>
                </div>
            </div>
        </div>

        <div id="screen-details" class="app-screen" style="display: none;">
            <div class="header">
                <span class="back-arrow" onclick="showScreen('tasks')">‚Üê</span>
                <span id="detail-title">–°–¥–µ–ª–∞—Ç—å —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—é</span>
            </div>
            <div class="content-wrap">
                <div id="detail-price" class="task-detail-price">520 ‚ÇΩ</div>
                
                <h4 style="margin-bottom: 5px;">–£—Å–ª–æ–≤–∏–µ:</h4>
                <p id="detail-description" style="margin-top: 0; font-size: 15px;">
                    –°–¥–µ–ª–∞—Ç—å —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—é –¥–µ—Ä–µ–≤–∞, –≤—ã—Å–æ—Ç–∞ –∫–æ—Ç–æ—Ä–æ–≥–æ –≤–∏–∑—É–∞–ª—å–Ω–æ –±—É–¥–µ—Ç –±–æ–ª—å—à–µ, —á–µ–º 3 –º–µ—Ç—Ä–∞. –§–æ—Ç–æ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ã–º.
                </p>

                <h4 style="margin-bottom: 5px;">–ü—Ä–∏–º–µ—Ä—ã —Ñ–æ—Ç–æ:</h4>
                <div id="task-images-area" class="task-detail-images">
                    <div class="image-placeholder">–ü—Ä–∏–º–µ—Ä 1</div>
                    <div class="image-placeholder">–ü—Ä–∏–º–µ—Ä 2</div>
                </div>
                
                <p style="font-size: 13px; color: var(--tg-theme-hint-color);">
                    *–í–∞–º –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—å —ç—Ç–æ —É—Å–ª–æ–≤–∏–µ
                </p>
                </div>
        </div>

        <div id="screen-wallet" class="app-screen" style="display: none;">
            <div class="header" style="justify-content: space-between; padding-right: 25px;">
                 –ö–æ—à–µ–ª—ë–∫
                 <span style="font-size: 20px;"></span>
            </div>
            
            <div class="wallet-balance-wrap">
                –ë–∞–ª–∞–Ω—Å:
                <div id="wallet-balance-value" class="wallet-balance">8 950 ‚ÇΩ</div>
                <span style="font-size: 20px; cursor: pointer;">
                    <span class="icon">
                        <span style="font-weight: 500; font-size: 20px;" onclick="toggleBalanceVisibility()">
                            &#128065;
                        </span>
                    </span>
                </span>
            </div>
            
            <div class="wallet-actions">
                <div class="wallet-action-item" onclick="alert('–û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å—Ä–µ–¥—Å—Ç–≤–∞')">
                    <div class="icon">‚Üë</div>
                    <span style="color: var(--tg-theme-link-color);">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</span>
                </div>
                <div class="wallet-action-item" onclick="alert('–í—ã–≤–æ–¥ —Å—Ä–µ–¥—Å—Ç–≤')"> 
                    <div class="icon">+</div>
                    <span style="color: var(--tg-theme-link-color);">–í–´–í–û–î</span>
                </div>
                <div class="wallet-action-item" onclick="alert('–ù–∞—Å—Ç—Ä–æ–π–∫–∏')">
                    <div class="icon">...</div>
                    <span style="color: var(--tg-theme-link-color);">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</span>
                </div>
            </div>
            
            <div class="content-wrap">
                <h3 style="margin-top: 20px; font-weight: 600;">–û–ø–µ—Ä–∞—Ü–∏–∏</h3>
                <div class="transaction-list">
                    <div class="transaction-item">
                        <div style="display: flex; align-items: center;">
                            <div class="nav-icon" style="margin-right: 10px; font-size: 18px; color: var(--tg-theme-link-color);">‚Üë</div>
                            <div>
                                <div class="transaction-amount-text">8 950 ‚ÇΩ</div>
                                <div class="task-hint">7 –∞–≤–≥. 12:46</div>
                            </div>
                        </div>
                        <div class="transaction-card-info">
                            **** 2843<br><span class="mir-logo">–ú–ò–†</span>
                        </div>
                    </div>
                    <div class="transaction-item">
                         <div style="display: flex; align-items: center;">
                            <div class="nav-icon" style="margin-right: 10px; font-size: 18px; color: var(--tg-theme-link-color);">‚Üë</div>
                            <div>
                                <div class="transaction-amount-text">2 350 ‚ÇΩ</div>
                                <div class="task-hint">5 –∞–≤–≥. 18:30</div>
                            </div>
                        </div>
                        <div class="transaction-card-info">
                            **** 2843<br><span class="mir-logo">–ú–ò–†</span>
                        </div>
                    </div>
                    <div class="transaction-item">
                        <div style="display: flex; align-items: center;">
                            <div class="nav-icon" style="margin-right: 10px; font-size: 18px; color: var(--tg-theme-link-color);">‚Üë</div>
                            <div>
                                <div class="transaction-amount-text">10 200 ‚ÇΩ</div>
                                <div class="task-hint">1 –∞–≤–≥. 12:12</div>
                            </div>
                        </div>
                        <div class="transaction-card-info">
                            **** 2843<br><span class="mir-logo">–ú–ò–†</span>
                        </div>
                    </div>
                    <div class="transaction-item">
                        <div style="display: flex; align-items: center;">
                            <div class="nav-icon" style="margin-right: 10px; font-size: 18px; color: var(--tg-theme-link-color);">‚Üë</div>
                            <div>
                                <div class="transaction-amount-text">2 150 ‚ÇΩ</div>
                                <div class="task-hint">30 –∏—é–ª. 17:22</div>
                            </div>
                        </div>
                        <div class="transaction-card-info">
                            **** 2843<br><span class="mir-logo">–ú–ò–†</span>
                        </div>
                    </div>
                </div>
            </div>
            </div>

        <div id="screen-moderation" class="app-screen" style="display: none; text-align: center; padding-top: 150px;">
            <h2 id="moderation-status">–§–æ—Ç–æ –Ω–∞ –º–æ–¥–µ—Ä–∞—Ü–∏–∏...</h2>
            <p style="font-size: 20px;">‚è≥</p>
        </div>
        
         <div id="screen-approval" class="app-screen" style="display: none; text-align: center; padding-top: 150px;">
            <h2 id="approval-status" style="color: var(--task-price-color);">‚úÖ –ó–∞–¥–∞–Ω–∏–µ –æ–¥–æ–±—Ä–µ–Ω–æ!</h2>
            <p style="font-size: 20px;">–°—Ä–µ–¥—Å—Ç–≤–∞ –∑–∞—á–∏—Å–ª–µ–Ω—ã –Ω–∞ –í–∞—à –±–∞–ª–∞–Ω—Å.</p>
        </div>

    </div>
    
    <div class="bottom-nav">
        <div id="nav-tasks" class="nav-item active" onclick="showScreen('tasks')">
            <div class="nav-icon">‚ò∞</div>
            <div>–ó–∞–¥–∞–Ω–∏—è</div>
        </div>
        <div id="nav-home" class="nav-item" onclick="showScreen('home')">
            <div class="nav-icon">üè†</div>
            <div>–î–æ–º–∏–∫</div>
        </div>
        <div id="nav-wallet" class="nav-item" onclick="showScreen('wallet')">
            <div class="nav-icon">üí≥</div>
            <div>–ö–æ—à–µ–ª–µ–∫</div>
        </div>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        const mainButton = tg.MainButton;
        
        let currentTaskId = null; 
        let currentTaskPrice = 0;
        let currentBalance = 8950; // –ò–º–∏—Ç–∞—Ü–∏—è –Ω–∞—á–∞–ª—å–Ω–æ–≥–æ –±–∞–ª–∞–Ω—Å–∞ (–∫–∞–∫ –Ω–∞ —Å–∫—Ä–∏–Ω—à–æ—Ç–µ)
        
        // --- –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –¥–µ–Ω–µ–≥ ---
        const formatCurrency = (amount) => `${amount.toLocaleString('ru-RU')} ‚ÇΩ`;

        // --- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏ –ê–¥–∞–ø—Ç–∞—Ü–∏—è –¢–µ–º—ã ---
        tg.ready();
        
        // –ü—Ä–∏–º–µ–Ω—è–µ–º —Ü–≤–µ—Ç–∞ —Ç–µ–º—ã Telegram
        if (tg.themeParams) {
            for (const key in tg.themeParams) {
                document.documentElement.style.setProperty(`--tg-${key}`, tg.themeParams[key]);
            }
        }
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –±–∞–ª–∞–Ω—Å –Ω–∞ UI
        function updateBalanceUI() {
            document.getElementById('wallet-balance-value').innerText = formatCurrency(currentBalance);
        }

        // --- –û–ë–†–ê–ë–û–¢–ß–ò–ö –ì–õ–ê–í–ù–û–ô –ö–ù–û–ü–ö–ò (–£–ù–ò–í–ï–†–°–ê–õ–¨–ù–´–ô) ---
        mainButton.onClick(() => {
            const buttonText = mainButton.text;
            if (buttonText === '–í–´–ü–û–õ–ù–ò–¢–¨') {
                startUploadProcess();
            } else if (buttonText === '–ó–ê–í–ï–†–®–ò–¢–¨') {
                finishTaskExecution();
            } else if (buttonText === '–ó–ê–ü–†–û–°–ò–¢–¨ –í–´–í–û–î') {
                initiateWithdrawal();
            }
        });


        // --- –õ–û–ì–ò–ö–ê –ü–ï–†–ï–ö–õ–Æ–ß–ï–ù–ò–Ø –≠–ö–†–ê–ù–û–í (SPA) ---
        function showScreen(screenName) {
            // –û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–µ–∞–∫—Ç–∏–≤–Ω–æ–≥–æ —Ä–∞–∑–¥–µ–ª–∞ "–î–æ–º–∏–∫"
            if (screenName === 'home') {
                 alert('–†–∞–∑–¥–µ–ª "–î–æ–º–∏–∫" –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω.');
                 return;
            }

            // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ —ç–∫—Ä–∞–Ω—ã
            document.querySelectorAll('.app-screen').forEach(screen => {
                screen.style.display = 'none';
            });
            // –î–µ–∞–∫—Ç–∏–≤–∏—Ä—É–µ–º MainButton –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
            mainButton.hide();

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω—É–∂–Ω—ã–π —ç–∫—Ä–∞–Ω
            const screenElement = document.getElementById(`screen-${screenName}`);
            if (screenElement) {
                screenElement.style.display = 'block';
            }

            // –û–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π —ç–ª–µ–º–µ–Ω—Ç –≤ –Ω–∏–∂–Ω–µ–º –º–µ–Ω—é
            document.querySelectorAll('.nav-item').forEach(item => item.classList.remove('active'));
            const navItem = document.getElementById(`nav-${screenName}`);
            if (navItem) {
                navItem.classList.add('active');
            }

            // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ MainButton –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —ç–∫—Ä–∞–Ω–∞
            if (screenName === 'wallet') {
                updateBalanceUI();
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º MainButton —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –±–∞–ª–∞–Ω—Å –Ω–µ 0
                if (currentBalance > 0) {
                    mainButton.setText('–ó–ê–ü–†–û–°–ò–¢–¨ –í–´–í–û–î');
                    mainButton.show();
                }
            } else if (screenName === 'details') {
                // MainButton –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –∫–∞–∫ –∫–Ω–æ–ø–∫–∞ "–í—ã–ø–æ–ª–Ω–∏—Ç—å" –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –¥–µ—Ç–∞–ª–µ–π
                mainButton.setText('–í–´–ü–û–õ–ù–ò–¢–¨');
                mainButton.show();
            } 
        }

        // --- –õ–û–ì–ò–ö–ê –û–¢–ö–†–´–¢–ò–Ø –î–ï–¢–ê–õ–ï–ô –ó–ê–î–ê–ù–ò–Ø ---
        function openTaskDetails(id, title, price, tool) {
            currentTaskId = id;
            currentTaskPrice = price;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∫–æ–Ω—Ç–µ–Ω—Ç —ç–∫—Ä–∞–Ω–∞ –¥–µ—Ç–∞–ª–µ–π
            document.getElementById('detail-title').innerText = title;
            document.getElementById('detail-price').innerText = formatCurrency(price);
            
            // –°–±—Ä–æ—Å –æ–±–ª–∞—Å—Ç–∏ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ (–ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–∏–º–µ—Ä—ã)
            document.getElementById('task-images-area').innerHTML = `
                <div class="image-placeholder">–ü—Ä–∏–º–µ—Ä 1</div>
                <div class="image-placeholder">–ü—Ä–∏–º–µ—Ä 2</div>
            `;
            
            showScreen('details');
        }
        
        // –®–∞–≥ 1: –ù–∞—á–∏–Ω–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É (–∫–Ω–æ–ø–∫–∞ "–í–´–ü–û–õ–ù–ò–¢–¨" -> "–ó–ê–í–ï–†–®–ò–¢–¨")
        function startUploadProcess() {
            // –ó–∞–º–µ–Ω—è–µ–º –ø—Ä–∏–º–µ—Ä—ã –Ω–∞ –∫–≤–∞–¥—Ä–∞—Ç—ã –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏
            document.getElementById('task-images-area').innerHTML = `
                <div class="image-placeholder upload-ready" onclick="simulateUpload(this)">
                    <span class="upload-icon">+</span>
                </div>
                <div class="image-placeholder upload-ready" onclick="simulateUpload(this)">
                    <span class="upload-icon">+</span>
                </div>
            `;
            
            // –ú–µ–Ω—è–µ–º –ì–ª–∞–≤–Ω—É—é –∫–Ω–æ–ø–∫—É –Ω–∞ "–ó–ê–í–ï–†–®–ò–¢–¨"
            mainButton.setText('–ó–ê–í–ï–†–®–ò–¢–¨');
            mainButton.setParams({ 
                color: tg.themeParams.button_color || '#007AFF'
            }); 
        }
        
        // –ò–º–∏—Ç–∞—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–æ—Ç–æ (—á–∏—Å—Ç–æ –¥–ª—è –≥–∞–ª–æ—á–∫–∏)
        function simulateUpload(placeholder) {
            placeholder.innerHTML = '‚úÖ';
            placeholder.style.backgroundColor = 'var(--task-price-color)';
            placeholder.style.color = 'white';
        }

        // –®–∞–≥ 2: –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –∏ –º–æ–¥–µ—Ä–∞—Ü–∏—è (–∫–Ω–æ–ø–∫–∞ "–ó–ê–í–ï–†–®–ò–¢–¨")
        function finishTaskExecution() {
            // –ò–º–∏—Ç–∞—Ü–∏—è –º–æ–¥–µ—Ä–∞—Ü–∏–∏
            showScreen('moderation');
            document.getElementById('moderation-status').innerText = '–§–æ—Ç–æ –Ω–∞ –º–æ–¥–µ—Ä–∞—Ü–∏–∏...';
            mainButton.hide();

            // 1. –ò–º–∏—Ç–∞—Ü–∏—è –∑–∞–¥–µ—Ä–∂–∫–∏ –º–æ–¥–µ—Ä–∞—Ü–∏–∏
            setTimeout(() => {
                // 2. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞ –∏ –ø–æ–∫–∞–∑ –æ–∫–Ω–∞ –æ–¥–æ–±—Ä–µ–Ω–∏—è
                currentBalance += currentTaskPrice;
                
                showScreen('approval'); // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –æ–∫–Ω–æ –æ–¥–æ–±—Ä–µ–Ω–∏—è (–∏–º–∏—Ç–∞—Ü–∏—è)
                document.getElementById('approval-status').innerText = `‚úÖ –ó–∞–¥–∞–Ω–∏–µ –æ–¥–æ–±—Ä–µ–Ω–æ! (+${formatCurrency(currentTaskPrice)})`;
                document.getElementById('approval-status').style.color = 'var(--task-price-color)';

                // 3. –û—Ç–ø—Ä–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –±–æ—Ç—É –¥–ª—è –∑–∞—á–∏—Å–ª–µ–Ω–∏—è:
                const data = JSON.stringify({ 
                    action: "task_approved", 
                    task_id: currentTaskId, 
                    amount: currentTaskPrice 
                });
                tg.sendData(data); 

                // 4. –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ –ö–æ—à–µ–ª–µ–∫ —á–µ—Ä–µ–∑ 2 —Å–µ–∫—É–Ω–¥—ã
                setTimeout(() => {
                    showScreen('wallet');
                }, 2000); 
            }, 3000); // 3 —Å–µ–∫—É–Ω–¥—ã –∏–º–∏—Ç–∞—Ü–∏–∏ –º–æ–¥–µ—Ä–∞—Ü–∏–∏
        }
        
        // --- –õ–û–ì–ò–ö–ê –í–´–í–û–î–ê –°–†–ï–î–°–¢–í ---
        function initiateWithdrawal() {
            // –ò–º–∏—Ç–∞—Ü–∏—è –º–æ–¥–µ—Ä–∞—Ü–∏–∏ –≤—ã–≤–æ–¥–∞
            showScreen('moderation');
            document.getElementById('moderation-status').innerText = '–ó–∞–ø—Ä–æ—Å –Ω–∞ –≤—ã–≤–æ–¥ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è...';
            mainButton.hide();
            
            const withdrawalAmount = currentBalance; // –°—É–º–º–∞, –∫–æ—Ç–æ—Ä—É—é –≤—ã–≤–æ–¥–∏–º

            setTimeout(() => {
                // –ò–º–∏—Ç–∞—Ü–∏—è –æ–¥–æ–±—Ä–µ–Ω–∏—è –≤—ã–≤–æ–¥–∞
                showScreen('approval');
                document.getElementById('approval-status').innerText = `üí∏ –ó–∞–ø—Ä–æ—Å –Ω–∞ –≤—ã–≤–æ–¥ ${formatCurrency(withdrawalAmount)} –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω!`;
                document.getElementById('approval-status').style.color = 'var(--tg-theme-text-color)';
                
                // –°–±—Ä–æ—Å –±–∞–ª–∞–Ω—Å–∞ –¥–æ 0 –ø–æ—Å–ª–µ –≤—ã–≤–æ–¥–∞ (–ø–æ –≤–∞—à–µ–º—É —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—é)
                currentBalance = 0;
                
                // –û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ –Ω–∞ –≤—ã–≤–æ–¥ –±–æ—Ç—É
                tg.sendData(JSON.stringify({ 
                    action: "withdrawal_request", 
                    amount: withdrawalAmount, 
                    user_id: tg.initDataUnsafe.user.id 
                }));
                
                // –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ –ö–æ—à–µ–ª–µ–∫ —Å –Ω—É–ª–µ–≤—ã–º –±–∞–ª–∞–Ω—Å–æ–º
                setTimeout(() => {
                    showScreen('wallet');
                }, 2000); 
            }, 4000); // 4 —Å–µ–∫—É–Ω–¥—ã –∏–º–∏—Ç–∞—Ü–∏–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏
        }
        
        // --- –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–∫—Ä—ã—Ç–∏—è/–ø–æ–∫–∞–∑–∞ –±–∞–ª–∞–Ω—Å–∞ ---
        function toggleBalanceVisibility() {
            const balanceElement = document.getElementById('wallet-balance-value');
            if (balanceElement.innerText.includes('****')) {
                balanceElement.innerText = formatCurrency(currentBalance);
            } else {
                balanceElement.innerText = '**** ‚ÇΩ';
            }
        }

        // –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —ç–∫—Ä–∞–Ω
        showScreen('tasks'); 
    </script>
</body>
</html>
